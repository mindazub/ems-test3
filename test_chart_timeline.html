<!DOCTYPE html>
<html>

<head>
    <title>Chart Timeline Test</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .chart-container {
            width: 90%;
            height: 400px;
            margin: 20px auto;
        }

        .info {
            background: #e3f2fd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <h1>24-Hour Chart Timeline Demo</h1>

    <div class="info">
        <strong>Features implemented:</strong>
        <ul>
            <li>✅ Always shows full 24-hour timeline (00:00 to 23:50)</li>
            <li>✅ 30-minute tick marks (48 intervals)</li>
            <li>✅ Shows partial data for today (half-filled chart)</li>
            <li>✅ Empty slots where no data exists</li>
            <li>✅ Smart date restrictions (days without data are disabled)</li>
            <li>✅ Backend endpoint for available dates</li>
        </ul>
    </div>

    <div class="chart-container">
        <canvas id="demoChart"></canvas>
    </div>

    <script>
        // Generate full 24-hour timeline with 30-minute intervals
        function generateFullTimeline() {
            const timeline = [];
            for (let hour = 0; hour < 24; hour++) {
                for (let minute = 0; minute < 60; minute += 30) {
                    const timeStr = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                    timeline.push(timeStr);
                }
            }
            return timeline;
        }

        // Simulate partial data (like today's data)
        function generateSampleData(timeline) {
            const data = new Array(timeline.length).fill(null);
            const currentHour = new Date().getHours();
            const currentMinute = new Date().getMinutes();

            // Fill data up to current time (simulating today's partial data)
            for (let i = 0; i < timeline.length; i++) {
                const time = timeline[i];
                const [hour, minute] = time.split(':').map(Number);

                if (hour < currentHour || (hour === currentHour && minute <= currentMinute)) {
                    // Generate realistic energy data pattern
                    let value = 0;
                    if (hour >= 6 && hour <= 18) { // Daytime solar generation
                        value = Math.sin((hour - 6) / 12 * Math.PI) * 50 + Math.random() * 10;
                    } else { // Nighttime low values
                        value = Math.random() * 5;
                    }
                    data[i] = Math.max(0, value);
                }
            }

            return data;
        }

        // Create chart
        const timeline = generateFullTimeline();
        const sampleData = generateSampleData(timeline);

        const ctx = document.getElementById('demoChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: timeline,
                datasets: [{
                    label: 'Solar Power (kW)',
                    data: sampleData,
                    borderColor: 'rgba(0,123,255,1)',
                    backgroundColor: 'rgba(0,123,255,0.15)',
                    fill: true,
                    pointRadius: 1,
                    pointHoverRadius: 6,
                    spanGaps: false,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Today\'s Energy Data (Partial Fill Demo)'
                    },
                    tooltip: {
                        filter: function (tooltipItem) {
                            return tooltipItem.parsed.y !== null;
                        }
                    }
                },
                scales: {
                    y: {
                        title: { display: true, text: 'Power (kW)' },
                        beginAtZero: true
                    },
                    x: {
                        ticks: {
                            maxTicksLimit: 24,
                            callback: function (value, index) {
                                const time = this.getLabelForValue(value);
                                return time.endsWith(':00') ? time : '';
                            }
                        },
                        title: { display: true, text: 'Time (24-hour format)' }
                    }
                }
            }
        });

        console.log('Demo chart created with:');
        console.log(`- Timeline points: ${timeline.length}`);
        console.log(`- Data points filled: ${sampleData.filter(d => d !== null).length}`);
        console.log(`- Empty points: ${sampleData.filter(d => d === null).length}`);
    </script>
</body>

</html>