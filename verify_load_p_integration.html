<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Load_p Integration Verification</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .success {
            color: green;
            font-weight: bold;
        }

        .info {
            color: blue;
        }

        .warning {
            color: orange;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        .negative {
            color: red;
        }

        .positive {
            color: green;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Load_p Integration Verification</h1>

        <div class="section">
            <h2>‚úÖ Implementation Updates Completed</h2>
            <div class="success">
                <p>1. ‚úÖ Load data source changed from batteryPriceData to energyData</p>
                <p>2. ‚úÖ Load values converted from negative to positive (Math.abs)</p>
                <p>3. ‚úÖ Table simplified to use load_p directly from energyData</p>
                <p>4. ‚úÖ Debug logging enhanced to show raw vs processed values</p>
            </div>
        </div>

        <div class="section">
            <h2>üìä API Data Structure Analysis</h2>
            <div class="info">
                <p><strong>Your API Response Structure:</strong></p>
                <pre>
{
    "aggregated_data_snapshots": [
        {
            "battery_p": -914696.0,        // Battery power (W)
            "battery_savings": -2.339,     // Battery savings
            "battery_soc": 71.246,         // State of charge (%)
            "dt": 1749790500,              // Unix timestamp
            "grid_p": 708490.76,           // Grid power (W)
            "load_p": -49380.05,           // Load power (W) - NEGATIVE!
            "price": 39.62,                // Energy price (EUR/MWh)
            "pv_p": 255585.29,             // PV power (W)
            "uid": "dbfb6e83-...",         // Unique ID
            "wind_p": 0.0                  // Wind power (W)
        }
    ]
}
                </pre>

                <p><strong>Backend Processing:</strong></p>
                <ul>
                    <li>Converts Unix timestamp (dt) to ISO string</li>
                    <li>Maps to both energy_chart and battery_price arrays</li>
                    <li>Includes load_p in energy_chart for Energy Live Chart</li>
                    <li>Includes load_p in battery_price for legacy compatibility</li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h2>üîÑ Load Data Processing</h2>
            <div class="info">
                <p><strong>Sample Load Values from API:</strong></p>
                <table>
                    <tr>
                        <th>Timestamp (dt)</th>
                        <th>Raw load_p (W)</th>
                        <th>Processed Load (kW)</th>
                        <th>Processing</th>
                    </tr>
                    <tr>
                        <td>1749790500</td>
                        <td class="negative">-49380.05</td>
                        <td class="positive">49.38</td>
                        <td>Math.abs(-49380.05 / 1000)</td>
                    </tr>
                    <tr>
                        <td>1749790800</td>
                        <td class="negative">-53655.36</td>
                        <td class="positive">53.66</td>
                        <td>Math.abs(-53655.36 / 1000)</td>
                    </tr>
                    <tr>
                        <td>1749791100</td>
                        <td class="negative">-46555.0</td>
                        <td class="positive">46.56</td>
                        <td>Math.abs(-46555.0 / 1000)</td>
                    </tr>
                </table>

                <p><strong>Why Math.abs():</strong></p>
                <ul>
                    <li>Load power is typically negative in energy systems (consumption)</li>
                    <li>For display purposes, we show positive values (easier to read)</li>
                    <li>Maintains consistency with other positive power values (PV, Grid)</li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h2>üìà Chart Integration</h2>
            <div class="info">
                <p><strong>Energy Live Chart now displays:</strong></p>
                <ul>
                    <li><span style="color: rgba(0,123,255,1);">‚ñ†</span> PV (kW) - Blue with fill</li>
                    <li><span style="color: rgba(220,53,69,1);">‚ñ†</span> Battery (kW) - Red with fill</li>
                    <li><span style="color: rgba(40,167,69,1);">‚ñ†</span> Grid (kW) - Green with fill</li>
                    <li><span style="color: rgba(255,165,0,1);">‚ñ†</span> <strong>Load (kW) - Orange without
                            fill</strong></li>
                </ul>

                <p><strong>Data flow:</strong></p>
                <pre>
API aggregated_data_snapshots ‚Üí Backend energy_chart ‚Üí Frontend energyData ‚Üí Chart & Table
                </pre>
            </div>
        </div>

        <div class="section">
            <h2>üîç Debug Information</h2>
            <div class="warning">
                <p><strong>Console logs to look for:</strong></p>
                <pre>
=== PROCESSING LOAD DATA FOR ENERGY CHART ===
Load mapping 0: Raw=-49380.05W, Processed=49.38kW
Load mapping 1: Raw=-53655.36W, Processed=53.66kW
...
=== END LOAD DATA PROCESSING ===
                </pre>

                <p><strong>What to verify:</strong></p>
                <ol>
                    <li>Orange Load curve appears on Energy Live Chart</li>
                    <li>Load values are positive in both chart and table</li>
                    <li>Load data matches the pattern from your API response</li>
                    <li>Console shows raw negative values being converted to positive</li>
                    <li>Table shows 5 columns: Time, PV, Battery, Grid, Load</li>
                </ol>
            </div>
        </div>

        <div class="section">
            <h2>üöÄ Testing Steps</h2>
            <div class="info">
                <p><strong>To verify the implementation:</strong></p>
                <ol>
                    <li>Open browser developer tools (F12)</li>
                    <li>Go to Console tab</li>
                    <li>Load the plant dashboard</li>
                    <li>Select a date with data</li>
                    <li>Check for load processing logs in console</li>
                    <li>Verify orange Load curve on Energy Live Chart</li>
                    <li>Check Data tab shows Load column with positive values</li>
                    <li>Confirm load values make sense (typically 20-100 kW for residential)</li>
                </ol>
            </div>
        </div>
    </div>
</body>

</html>