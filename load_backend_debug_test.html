<!DOCTYPE html>
<html>

<head>
    <title>Load Data Backend Debug Test</title>
</head>

<body>
    <h1>Load Data Backend Debug Test</h1>
    <p>Checking backend data processing for load_p...</p>
    <div id="result"></div>

    <script>
        // Get plant ID from URL or use default
        const plantId = new URLSearchParams(window.location.search).get('plant_id') || 'dbfb6e83-5990-45e0-9cc2-4b579cc536c4';
        const selectedDate = new Date().toISOString().split('T')[0]; // Today

        console.log('Testing load data backend processing...');
        console.log('Plant ID:', plantId);
        console.log('Date:', selectedDate);

        // Make request to backend API to trigger enhanced debug logging
        fetch(`/plants/${plantId}/chart-data?date=${selectedDate}`)
            .then(response => response.json())
            .then(data => {
                console.log('=== API RESPONSE ===');
                console.log('Full response:', data);

                if (data.energy_chart) {
                    console.log('Energy chart keys:', Object.keys(data.energy_chart));
                    const firstEntry = Object.values(data.energy_chart)[0];
                    console.log('First energy chart entry:', firstEntry);
                    console.log('Load data in first entry:', firstEntry?.load_p);
                }

                if (data.battery_price) {
                    console.log('Battery price keys:', Object.keys(data.battery_price));
                    const firstBatteryEntry = Object.values(data.battery_price)[0];
                    console.log('First battery price entry:', firstBatteryEntry);
                    console.log('Load data in first battery entry:', firstBatteryEntry?.load_p);
                }

                document.getElementById('result').innerHTML =
                    '<h2>API Response received</h2>' +
                    '<p>Check browser console and Laravel logs for detailed debug information</p>' +
                    '<p>Energy chart entries: ' + (data.energy_chart ? Object.keys(data.energy_chart).length : 0) + '</p>' +
                    '<p>Battery price entries: ' + (data.battery_price ? Object.keys(data.battery_price).length : 0) + '</p>';
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('result').innerHTML = '<h2>Error: ' + error.message + '</h2>';
            });
    </script>
</body>

</html>